(window.webpackJsonp=window.webpackJsonp||[]).push([[1058],{1480:function(e,t,a){"use strict";a.r(t);var r=a(9),s=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"digitalocean-one-click"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#digitalocean-one-click"}},[e._v("#")]),e._v(" DigitalOcean One-click")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://www.digitalocean.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("DigitalOcean"),a("OutboundLink")],1),e._v(" provide a simple way to deploy Strapi with an easy click of the mouse.")]),e._v(" "),a("p",[e._v("You can find the image generation "),a("a",{attrs:{href:"https://github.com/strapi/one-click-deploy/tree/master/digital-ocean",target:"_blank",rel:"noopener noreferrer"}},[e._v("source code"),a("OutboundLink")],1),e._v(" on Strapi's GitHub 了解详情.")]),e._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#creating-the-virtual-machine"}},[e._v("Creating the Virtual Machine")]),a("ul",[a("li",[a("a",{attrs:{href:"#step-1-create-a-digitalocean-account"}},[e._v("Step 1: Create a DigitalOcean account")])]),a("li",[a("a",{attrs:{href:"#step-2-create-a-project"}},[e._v("Step 2: Create a project")])]),a("li",[a("a",{attrs:{href:"#step-3-visit-your-app"}},[e._v("Step 3: Visit your app")])])])]),a("li",[a("a",{attrs:{href:"#default-server-configuration"}},[e._v("Default server configuration")])]),a("li",[a("a",{attrs:{href:"#file-and-software-paths"}},[e._v("File and Software paths")]),a("ul",[a("li",[a("a",{attrs:{href:"#nginx"}},[e._v("Nginx")])]),a("li",[a("a",{attrs:{href:"#strapi"}},[e._v("Strapi")])])])]),a("li",[a("a",{attrs:{href:"#使用-service-account"}},[e._v("使用 Service Account")]),a("ul",[a("li",[a("a",{attrs:{href:"#accessing-the-service-account"}},[e._v("Accessing the service account")])]),a("li",[a("a",{attrs:{href:"#controlling-the-strapi-service-and-viewing-logs"}},[e._v("Controlling the Strapi service and viewing logs")])])])]),a("li",[a("a",{attrs:{href:"#changing-the-postgresql-password"}},[e._v("Changing the PostgreSQL Password")])])])]),a("p"),e._v(" "),a("h2",{attrs:{id:"creating-the-virtual-machine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creating-the-virtual-machine"}},[e._v("#")]),e._v(" Creating the Virtual Machine")]),e._v(" "),a("h3",{attrs:{id:"step-1-create-a-digitalocean-account"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-1-create-a-digitalocean-account"}},[e._v("#")]),e._v(" Step 1: Create a DigitalOcean account")]),e._v(" "),a("p",[e._v("If you don't have a DigitalOcean account you will need to create one, you can use "),a("a",{attrs:{href:"https://try.digitalocean.com/strapi/",target:"_blank",rel:"noopener noreferrer"}},[e._v("this referral link"),a("OutboundLink")],1),e._v(" to get $100 of free credits!")]),e._v(" "),a("h3",{attrs:{id:"step-2-create-a-project"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-2-create-a-project"}},[e._v("#")]),e._v(" Step 2: Create a project")]),e._v(" "),a("p",[e._v("To create a project head over to the Strapi "),a("a",{attrs:{href:"https://marketplace.digitalocean.com/apps/strapi",target:"_blank",rel:"noopener noreferrer"}},[e._v("listing on the marketplace"),a("OutboundLink")],1),e._v(" and follow these steps:")]),e._v(" "),a("ul",[a("li",[e._v("点击 "),a("code",[e._v("Create Strapi Droplet")]),e._v(" button")]),e._v(" "),a("li",[e._v("Keep the selected Starter - Standard Plan")]),e._v(" "),a("li",[e._v("Select your virtual machine size (minimum of 2 GB/1 CPU)")]),e._v(" "),a("li",[e._v("Choose your datacenter (closest to you or your target area)")]),e._v(" "),a("li",[e._v("添加 a new SSH key, if you are on windows you can follow "),a("a",{attrs:{href:"https://www.digitalocean.com/docs/droplets/how-to/add-ssh-keys/create-with-putty/",target:"_blank",rel:"noopener noreferrer"}},[e._v("this guide"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("Give your virtual machine a hostname")]),e._v(" "),a("li",[e._v("(optional) Enable backups")]),e._v(" "),a("li",[e._v("Finally hit Create Droplet!")])]),e._v(" "),a("h3",{attrs:{id:"step-3-visit-your-app"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-3-visit-your-app"}},[e._v("#")]),e._v(" Step 3: Visit your app")]),e._v(" "),a("p",[e._v("Please note that it may take anywhere from 30 seconds to a few minutes for the droplet to startup, when it does you should see it in your "),a("a",{attrs:{href:"https://cloud.digitalocean.com/droplets",target:"_blank",rel:"noopener noreferrer"}},[e._v("droplets list"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),a("p",[e._v("After the droplet has started, it will take a few more minutes to finish the Strapi installation.")])]),e._v(" "),a("p",[e._v("From here you will see the public ipv4 address that you can use to visit your Strapi application, just open that in a browser and it should ask you to create your first administrator!")]),e._v(" "),a("p",[e._v("You can also SSH into the virtual machine using "),a("code",[e._v("root")]),e._v(" as the SSH user and your public ipv4 address, there is no password for SSH as DigitalOcean uses SSH keys by default with password authentication disabled.")]),e._v(" "),a("h2",{attrs:{id:"default-server-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#default-server-configuration"}},[e._v("#")]),e._v(" Default server configuration")]),e._v(" "),a("p",[e._v("From the initial startup you should not need to configure anything to get started, there is some included software that is configured:")]),e._v(" "),a("ul",[a("li",[e._v("Node.js v12 (installed via the offical "),a("a",{attrs:{href:"https://github.com/nodesource/distributions/blob/master/README.md#installation-instructions",target:"_blank",rel:"noopener noreferrer"}},[e._v("apt repository"),a("OutboundLink")],1),e._v(")")]),e._v(" "),a("li",[e._v("Yarn Latest Stable (installed via the official "),a("a",{attrs:{href:"https://classic.yarnpkg.com/en/docs/install/#debian-stable",target:"_blank",rel:"noopener noreferrer"}},[e._v("apt repository"),a("OutboundLink")],1),e._v(")")]),e._v(" "),a("li",[e._v("Nginx Latest (Ubuntu default repository)")]),e._v(" "),a("li",[e._v("UFW (Uncomplicated Firewall)\n"),a("ul",[a("li",[e._v("Configured to only allow incoming ports: 80 (HTTP), 443 (HTTPS), and 22 (SSH)")])])]),e._v(" "),a("li",[e._v("PostgreSQL Latest (Ubuntu default repository)")]),e._v(" "),a("li",[e._v("PM2 (Installed globally using Yarn)")])]),e._v(" "),a("h2",{attrs:{id:"file-and-software-paths"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#file-and-software-paths"}},[e._v("#")]),e._v(" File and Software paths")]),e._v(" "),a("h3",{attrs:{id:"nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[e._v("#")]),e._v(" Nginx")]),e._v(" "),a("p",[e._v("The DigitalOcean one-click application uses Nginx to proxy http on port 80 to Strapi, this is to ensure the system is secure as running any application on ports below 1024 require root permissions.")]),e._v(" "),a("p",[e._v("The example config included by default is located at "),a("code",[e._v("/etc/nginx/sites-available/strapi.conf")]),e._v(" and the upstream block is located at "),a("code",[e._v("/etc/nginx/conf.d/upstream.conf")])]),e._v(" "),a("p",[e._v("To learn more about the Nginx proxy options you can view the Nginx proxy "),a("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_proxy_module.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("文章"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("Tabs",{attrs:{type:"border-card"}},[a("Tab",{attrs:{label:"strapi.conf"}},[a("p",[e._v("Path: "),a("code",[e._v("/etc/nginx/sites-available/strapi.conf")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('server {\n\n# Listen HTTP\n    listen 80;\n    server_name _;\n\n# Proxy Config\n    location / {\n        proxy_pass http://strapi;\n        proxy_http_version 1.1;\n        proxy_set_header X-Forwarded-Host $host;\n        proxy_set_header X-Forwarded-Server $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header Host $http_host;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "Upgrade";\n        proxy_pass_request_headers on;\n    }\n}\n')])])])]),e._v(" "),a("Tab",{attrs:{label:"upstream.conf"}},[a("p",[e._v("Path: "),a("code",[e._v("/etc/nginx/conf.d/upstream.conf")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("upstream strapi {\n    server 127.0.0.1:1337;\n}\n")])])])])],1),e._v(" "),a("h3",{attrs:{id:"strapi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#strapi"}},[e._v("#")]),e._v(" Strapi")]),e._v(" "),a("p",[e._v("In the DigitalOcean one-click application a service user is used in which it's home directory is located at "),a("code",[e._v("/srv/strapi")]),e._v(". Likewise the actual Strapi application is located within this home directory at "),a("code",[e._v("/srv/strapi/strapi-development")]),e._v(".")]),e._v(" "),a("p",[e._v("Please note that with this application it is initially created and ran in the "),a("code",[e._v("development")]),e._v(" environment to allow for creating models. "),a("strong",[e._v("You should not use this directly in production")]),e._v(", it is recommended that you configure a private git repository to commit changes into and create a new application directory within the service user's home (示例: "),a("code",[e._v("/srv/strapi/strapi-production")]),e._v("). To run the new "),a("code",[e._v("production")]),e._v(" or "),a("code",[e._v("staging")]),e._v(" environments you can refer to the "),a("a",{attrs:{href:"https://pm2.keymetrics.io/docs/usage/quick-start/#managing-processes",target:"_blank",rel:"noopener noreferrer"}},[e._v("PM2 文档"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"使用-service-account"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-service-account"}},[e._v("#")]),e._v(" 使用 Service Account")]),e._v(" "),a("p",[e._v('By default the Strapi application will be running under a "service account", this is an account that is extremely limited into what it can do and access. The purpose of using a service account is to help protect your system from security threats.')]),e._v(" "),a("h3",{attrs:{id:"accessing-the-service-account"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#accessing-the-service-account"}},[e._v("#")]),e._v(" Accessing the service account")]),e._v(" "),a("p",[e._v("The first step in accessing your service account is to SSH into the root user, depending on your Operating System or your SSH client there may be multiple ways to do this. You should refer to your SSH clients documentation for clarification on using SSH keys.")]),e._v(" "),a("p",[e._v("After you have successfully logged into the root user you can now run "),a("code",[e._v("sudo su strapi")]),e._v(" and this will take you to the "),a("code",[e._v("strapi")]),e._v(" user's shell. To go back to the root user simply run "),a("code",[e._v("exit")]),e._v(".")]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),a("p",[e._v("Please note that by default the "),a("code",[e._v("strapi")]),e._v(" user "),a("strong",[e._v("cannot run sudo commands")]),e._v(" this is intended!")])]),e._v(" "),a("h3",{attrs:{id:"controlling-the-strapi-service-and-viewing-logs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#controlling-the-strapi-service-and-viewing-logs"}},[e._v("#")]),e._v(" Controlling the Strapi service and viewing logs")]),e._v(" "),a("p",[e._v("Once you are in the Strapi service account you can now use "),a("a",{attrs:{href:"https://pm2.keymetrics.io/docs/usage/quick-start/#managing-processes",target:"_blank",rel:"noopener noreferrer"}},[e._v("PM2"),a("OutboundLink")],1),e._v(" to manage the Strapi process and view the logs.")]),e._v(" "),a("p",[e._v("The default service is called "),a("code",[e._v("strapi-development")]),e._v(" and should be running with an ID of "),a("code",[e._v("0")]),e._v(". Below are some example commands for PM2:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("pm2 list "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Will show you a list of all running processes")]),e._v("\npm2 restart strapi-development "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Restart the Strapi process manually")]),e._v("\npm2 stop strapi-development "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Stop the Strapi process")]),e._v("\npm2 start strapi-development "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Start the Strapi process")]),e._v("\npm2 logs strapi-development "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Show the logs in real time (to exit use ctrl +c)")]),e._v("\n")])])]),a("p",[e._v("Strapi will automatically start if the virtual machine is rebooted, you can also manually view the log files under "),a("code",[e._v("/srv/strapi/.pm2/logs")]),e._v(" if you encounter any errors during the bootup.")]),e._v(" "),a("h2",{attrs:{id:"changing-the-postgresql-password"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#changing-the-postgresql-password"}},[e._v("#")]),e._v(" Changing the PostgreSQL Password")]),e._v(" "),a("p",[e._v("Use the following steps to change the PostgreSQL password and update Strapi's config:")]),e._v(" "),a("ul",[a("li",[e._v("Make sure you are logged into the "),a("code",[e._v("strapi")]),e._v(" service user")]),e._v(" "),a("li",[e._v("Stop the current strapi process and change the password for the "),a("code",[e._v("strapi")]),e._v(" database user")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("pm2 stop strapi-development\npsql -c "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("\"ALTER USER strapi with password 'your-new-password';\"")]),e._v("\n")])])]),a("ul",[a("li",[e._v("Update the "),a("code",[e._v("/srv/strapi/strapi-development/.env")]),e._v(" file with the new password.")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("DATABASE_PASSWORD=your-new-password\n")])])]),a("ul",[a("li",[e._v("Restart Strapi and confirm the password change was successful")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("pm2 start strapi-development\npm2 logs strapi-development\n")])])])],1)}),[],!1,null,null,null);t.default=s.exports}}]);