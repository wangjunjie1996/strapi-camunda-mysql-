(window.webpackJsonp=window.webpackJsonp||[]).push([[1048],{1470:function(t,a,e){"use strict";e.r(a);var s=e(9),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"google-app-engine"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#google-app-engine"}},[t._v("#")]),t._v(" Google App Engine")]),t._v(" "),e("p",[t._v("In this guide we are going to:")]),t._v(" "),e("ul",[e("li",[t._v("创建 a new Strapi project")]),t._v(" "),e("li",[t._v("Configure PostgreSQL for the production enviroment")]),t._v(" "),e("li",[t._v("Deploy the app to Google App Engine")]),t._v(" "),e("li",[t._v("添加 the "),e("a",{attrs:{href:"https://github.com/Lith/strapi-provider-upload-google-cloud-storage",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Cloud Storage file uploading plugin"),e("OutboundLink")],1),t._v(" by "),e("a",{attrs:{href:"https://github.com/Lith",target:"_blank",rel:"noopener noreferrer"}},[t._v("@Lith"),e("OutboundLink")],1)])]),t._v(" "),e("h3",{attrs:{id:"new-strapi-project"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#new-strapi-project"}},[t._v("#")]),t._v(" New Strapi project")]),t._v(" "),e("Tabs",{attrs:{type:"border-card"}},[e("Tab",{attrs:{label:"yarn"}},[e("p",[t._v("Use "),e("strong",[t._v("yarn")]),t._v(" to install the Strapi project ("),e("strong",[t._v("recommended")]),t._v("). "),e("a",{attrs:{href:"https://yarnpkg.com/lang/en/docs/install/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Install yarn with these docs"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" create strapi-app my-project --quickstart\n")])])])]),t._v(" "),e("Tab",{attrs:{label:"npx"}},[e("p",[t._v("Use "),e("strong",[t._v("npm/npx")]),t._v(" to install the Strapi project")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("npx create-strapi-app my-project --quickstart\n")])])])])],1),t._v(" "),e("p",[t._v("When the setup completes, register an admin user using the form which opens in the browser. This user will be only relevant in local development.")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("sqlite")]),t._v(" database is created at "),e("code",[t._v(".tmp/data.db")]),t._v(".")]),t._v(" "),e("p",[t._v("Login, but don't add content types yet. Close the browser. Quit the running app.")]),t._v(" "),e("h3",{attrs:{id:"initial-commit"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#initial-commit"}},[t._v("#")]),t._v(" Initial commit")]),t._v(" "),e("p",[t._v("This may be a good point to commit the files in their initial state.")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" my-project\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" init\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m first\n")])])]),e("h3",{attrs:{id:"install-the-cloud-sdk-cli-tool"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#install-the-cloud-sdk-cli-tool"}},[t._v("#")]),t._v(" Install the Cloud SDK CLI tool")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://cloud.google.com/sdk/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cloud SDK: Command Line Interface"),e("OutboundLink")],1)]),t._v(" "),e("h3",{attrs:{id:"new-app-engine-project"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#new-app-engine-project"}},[t._v("#")]),t._v(" New App Engine project")]),t._v(" "),e("p",[t._v("Create a new "),e("a",{attrs:{href:"https://console.cloud.google.com/appengine/",target:"_blank",rel:"noopener noreferrer"}},[t._v("App Engine"),e("OutboundLink")],1),t._v(" project.")]),t._v(" "),e("p",[t._v("Select the region, such as "),e("code",[t._v("europe-west")]),t._v(".")]),t._v(" "),e("ul",[e("li",[t._v("Language: Node JS")]),t._v(" "),e("li",[t._v("Environment: Standard (or Flexible)")])]),t._v(" "),e("p",[t._v("("),e("em",[t._v("A note on performance and cost")]),t._v(": the "),e("code",[t._v("Standard Environment")]),t._v(" is sufficient for development, but it may not be for production. Review the resources your application will need to determine the cost. When you sign up for Google App Engine, it offers a certain amount of free credits which will not be billed.)")]),t._v(" "),e("p",[t._v("Create the project. Take note of the instance identifier, which is in the form of "),e("code",[t._v("<instance_id>:<region>:<instance_name>")]),t._v(".")]),t._v(" "),e("p",[t._v("Check if "),e("code",[t._v("gcloud")]),t._v(" lists the project:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("gcloud projects list\n")])])]),e("p",[t._v("Run "),e("code",[t._v("init")]),t._v(" to authenticate the cli, and select current cloud project.")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("gcloud init\n")])])]),e("h3",{attrs:{id:"create-the-database-postgresql"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-the-database-postgresql"}},[t._v("#")]),t._v(" Create the database (PostgreSQL)")]),t._v(" "),e("p",[t._v("Create the "),e("a",{attrs:{href:"https://cloud.google.com/sql/docs/postgres/create-manage-databases",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cloud SQL database"),e("OutboundLink")],1),t._v(" which the app is going to use.")]),t._v(" "),e("p",[t._v("Take note of the user name (default is "),e("code",[t._v("postgres")]),t._v(") and password.")]),t._v(" "),e("p",[t._v("The first database will be created with the name "),e("code",[t._v("postgres")]),t._v(". This cannot be deleted.")]),t._v(" "),e("p",[t._v("Create another database, named "),e("code",[t._v("strapi")]),t._v(" for example. It may be useful to delete and and re-create this while you are experimenting with the application setup.")]),t._v(" "),e("h3",{attrs:{id:"create-app-yaml-and-gcloudignore"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-app-yaml-and-gcloudignore"}},[t._v("#")]),t._v(" Create app.yaml and .gcloudignore")]),t._v(" "),e("p",[t._v("Create the "),e("code",[t._v("app.yaml")]),t._v(" file in the project root.")]),t._v(" "),e("p",[t._v("Add "),e("code",[t._v("app.yaml")]),t._v(" to "),e("code",[t._v(".gitignore")]),t._v(".")]),t._v(" "),e("p",[t._v("The instance identifier looks like "),e("code",[t._v("myapi-123456:europe-west1:myapi")]),t._v(".")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("myapi-123456")]),t._v(" part is the project identifier. (The number is automatically added to short project names).")]),t._v(" "),e("p",[t._v("The following is an example config for "),e("code",[t._v("Standard Environment")]),t._v(" or "),e("code",[t._v("Flexible Environment")]),t._v(".")]),t._v(" "),e("Tabs",{attrs:{type:"border-card"}},[e("Tab",{attrs:{label:"Standard Environment"}},[e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runtime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nodejs10\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance_class")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" F2\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env_variables")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("HOST")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NODE_ENV")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DATABASE_NAME")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'strapi'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DATABASE_USERNAME")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'postgres'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DATABASE_PASSWORD")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<password>'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("INSTANCE_CONNECTION_NAME")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<instance_identifier>'")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("beta_settings")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud_sql_instances")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<instance_identifier>'")]),t._v("\n")])])])]),t._v(" "),e("Tab",{attrs:{label:"Flexible Environment"}},[e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runtime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nodejs\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flex\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env_variables")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("HOST")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NODE_ENV")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DATABASE_NAME")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'strapi'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DATABASE_USERNAME")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'postgres'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DATABASE_PASSWORD")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<password>'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("INSTANCE_CONNECTION_NAME")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<instance_identifier>'")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("beta_settings")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud_sql_instances")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<instance_identifier>'")]),t._v("\n")])])])])],1),t._v(" "),e("p",[t._v("Create "),e("code",[t._v(".gcloudignore")]),t._v(" in the project root.")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("app.yaml\n.gcloudignore\n.git\n.gitignore\nnode_modules/\n#!include:.gitignore\n")])])]),e("p",[t._v("In the case of Strapi, the admin UI will have to be re-built after every deploy,\nand so we don't deploy local build artifacts, cache files and so on by including\nthe "),e("code",[t._v(".gitignore")]),t._v(" entries.")]),t._v(" "),e("h3",{attrs:{id:"configure-the-database"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-database"}},[t._v("#")]),t._v(" Configure the database")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("PostgreSQL")]),t._v(" database will need the "),e("code",[t._v("pg")]),t._v(" package.")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" pg\n")])])]),e("p",[e("a",{attrs:{href:"https://cloud.google.com/sql/docs/postgres/connect-app-engine",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google App Engine requires"),e("OutboundLink")],1),t._v(" to connect to the database using the unix socket path, not an IP and port.")]),t._v(" "),e("p",[t._v("Edit "),e("code",[t._v("database.js")]),t._v(", and use the socket path as "),e("code",[t._v("host")]),t._v(".")]),t._v(" "),e("p",[e("code",[t._v("Path: ./config/env/production/database.js")]),t._v(".")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  defaultConnection"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  connections"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      connector"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bookshelf'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      settings"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        client"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'postgres'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        host"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("/cloudsql/")]),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'INSTANCE_CONNECTION_NAME'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        database"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DATABASE_NAME'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        username"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DATABASE_USERNAME'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        password"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DATABASE_PASSWORD'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      options"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("h3",{attrs:{id:"auto-build-after-deploy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#auto-build-after-deploy"}},[t._v("#")]),t._v(" Auto-build after deploy")]),t._v(" "),e("p",[t._v("After deployment, the admin UI has to be re-built. This generates the contents of the "),e("code",[t._v("build")]),t._v(" folder on the server.")]),t._v(" "),e("p",[t._v("In "),e("code",[t._v("package.json")]),t._v(", add the "),e("code",[t._v("gcp-build")]),t._v(" command to "),e("code",[t._v("scripts")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"gcp-build"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"strapi build"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h3",{attrs:{id:"deploy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deploy"}},[t._v("#")]),t._v(" Deploy")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("gcloud app deploy app.yaml --project myapi-123456\n")])])]),e("p",[t._v("Watch the logs:")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("gcloud app logs "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" --project"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("myapi-123456 -s default\n")])])]),e("p",[t._v("Open the admin page and register and admin user.")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("https://myapp-123456.appspot.com/admin/\n")])])]),e("h3",{attrs:{id:"file-uploading-to-google-cloud-storage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#file-uploading-to-google-cloud-storage"}},[t._v("#")]),t._v(" File uploading to Google Cloud Storage")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/Lith/strapi-provider-upload-google-cloud-storage",target:"_blank",rel:"noopener noreferrer"}},[t._v("Lith/strapi-provider-upload-google-cloud-storage"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" strapi-provider-upload-google-cloud-storage\n")])])]),e("p",[t._v("Deploy so that the server app includes the dependency from "),e("code",[t._v("package.json")]),t._v(".")]),t._v(" "),e("p",[t._v("Follow the "),e("a",{attrs:{href:"https://github.com/Lith/strapi-provider-upload-google-cloud-storage/blob/master/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("documentation of the plugin"),e("OutboundLink")],1),t._v(" for the full configuration.")]),t._v(" "),e("h3",{attrs:{id:"post-setup-configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#post-setup-configuration"}},[t._v("#")]),t._v(" Post-setup configuration")]),t._v(" "),e("p",[e("strong",[t._v("CORS")])]),t._v(" "),e("p",[t._v("CORS is enabled by default, allowing "),e("code",[t._v("*")]),t._v(" origin. You may want to limit the allowed origins.")]),t._v(" "),e("p",[t._v("阅读 documentation "),e("RouterLink",{attrs:{to:"/developer-docs/latest/setup-deployment-guides/configurations.html#middlewares"}},[t._v("这里")]),t._v(".")],1),t._v(" "),e("p",[e("strong",[t._v("Changing the admin url")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("config/env/production/server.js\n")])])]),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  admin"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/dashboard'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])],1)}),[],!1,null,null,null);a.default=n.exports}}]);