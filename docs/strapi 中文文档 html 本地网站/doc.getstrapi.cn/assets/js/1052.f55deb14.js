(window.webpackJsonp=window.webpackJsonp||[]).push([[1052],{1474:function(t,a,s){"use strict";s.r(a);var e=s(9),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"caddy-proxying"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#caddy-proxying"}},[t._v("#")]),t._v(" Caddy Proxying")]),t._v(" "),s("p",[t._v('As Strapi does not handle SSL directly and hosting a Node.js service on the "edge" network is not a secure solution it is recommended that you use some sort of proxy application such as Nginx, Apache, HAProxy, Traefik, or others. Below you will find some sample configurations for Caddy, naturally these configs may not suit all environments and you will likely need to adjust them to fit your needs.')]),t._v(" "),s("p",[t._v('Caddy has some very easy to use options relating to Let\'s encrypt and automated SSL certificate issuing/renewing, while it is certainly the "newer" web server market, it is quickly becoming a great "non-technical" user application for proxying. '),s("strong",[t._v("Please do note that Caddy is still very much in development")]),t._v(" and as such is evolving often, this guide is based on Caddy v2.0.0.")]),t._v(" "),s("h2",{attrs:{id:"configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),s("p",[t._v('The below configuration is based on "Caddy File" type, this is a single file config that Caddy will use to run the web server. There are multiple other options such as the Caddy REST API that this guide will not cover, you should review the '),s("a",{attrs:{href:"https://caddyserver.com/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Caddy 文章"),s("OutboundLink")],1),t._v(" for further information on alternatives. You can also visit the "),s("a",{attrs:{href:"https://caddy.community/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Caddy Community"),s("OutboundLink")],1),t._v(" to speak with others relating to configuration questions.")]),t._v(" "),s("h3",{attrs:{id:"caddy-file"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#caddy-file"}},[t._v("#")]),t._v(" Caddy file")]),t._v(" "),s("p",[t._v("The Caddyfile is a convenient Caddy configuration format for humans. It is most people's favorite way to use Caddy because it is easy to write, easy to understand, and expressive enough for most use cases.")]),t._v(" "),s("p",[t._v("In the below examples you will need to replace your domain, and should you wish to use SSL you will need to tweak these Caddy file configs to suit your needs, SSL is not covered in this guide and you should review the Caddy documentation.")]),t._v(" "),s("p",[t._v("Below are 3 example Caddy configurations:")]),t._v(" "),s("ul",[s("li",[t._v("Sub-domain based such as "),s("code",[t._v("api.example.com")])]),t._v(" "),s("li",[t._v("Sub-folder based with both the API and Admin on the same sub-folder such as "),s("code",[t._v("example.com/api")]),t._v(" and "),s("code",[t._v("example.com/api/admin")])]),t._v(" "),s("li",[t._v("Sub-folder based with split API and Admin such as "),s("code",[t._v("example.com/api")]),t._v(" and "),s("code",[t._v("example.com/dashboard")])])]),t._v(" "),s("Tabs",{attrs:{type:"border-card"}},[s("Tab",{attrs:{label:"Sub-Domain"}},[s("h4",{attrs:{id:"sub-domain"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sub-domain"}},[t._v("#")]),t._v(" Sub-Domain")]),t._v(" "),s("p",[t._v("This config is using the sub-domain that is dedicated to Strapi only. It will bind to port 80 HTTP and proxies all requests (both api and admin) to the Strapi server running locally on the address specified. If you have configured Caddy properly to handle automated SSL you can remove the "),s("code",[t._v("http://")]),t._v(" and Caddy will automatically convert all HTTP to HTTPS traffic.")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("示例 Domain: "),s("code",[t._v("api.example.com")])]),t._v(" "),s("p",[s("strong",[t._v("Path —")]),t._v(" "),s("code",[t._v("/etc/caddy/Caddyfile")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("http://api.example.com {\n  reverse_proxy 127.0.0.1:1337\n}\n\n")])])])]),t._v(" "),s("Tab",{attrs:{label:"Sub-Folder-Unified"}},[s("h4",{attrs:{id:"sub-folder-unified"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sub-folder-unified"}},[t._v("#")]),t._v(" Sub-Folder Unified")]),t._v(" "),s("p",[t._v('This config is using a sub-folder that is dedicated to Strapi only. It will bind to port 80 HTTP and hosts the "frontend" files on '),s("code",[t._v("/var/www")]),t._v(" like a normal web server, but proxies all Strapi requests on the "),s("code",[t._v("example.com/api")]),t._v(" sub-path.")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("Please note that this config is not focused on the frontend hosting, you will most likely need to adjust this to your frontend software requirements, it is only being shown here as an example.")])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("示例 Domain: "),s("code",[t._v("example.com/api")])]),t._v(" "),s("p",[s("strong",[t._v("Path —")]),t._v(" "),s("code",[t._v("/etc/caddy/Caddyfile")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("http://api.example.com {\n  root * /var/www\n  file_server\n  route /api* {\n    uri strip_prefix /api\n    reverse_proxy 127.0.0.1:1337\n  }\n}\n")])])])]),t._v(" "),s("Tab",{attrs:{label:"Sub-Folder-Split"}},[s("h4",{attrs:{id:"sub-folder-split"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sub-folder-split"}},[t._v("#")]),t._v(" Sub-Folder Split")]),t._v(" "),s("p",[t._v('This config is using two sub-folders that are dedicated to Strapi. It will bind to port 80 HTTP and hosts the "frontend" files on '),s("code",[t._v("/var/www")]),t._v(" like a normal web server, but proxies all Strapi API requests on the "),s("code",[t._v("example.com/api")]),t._v(" sub-path. Likewise it will proxy all admin requests on the "),s("code",[t._v("example.com/dashboard")]),t._v(" sub-path.")]),t._v(" "),s("p",[t._v("Alternatively for the admin, you can replace the proxy instead with serving the admin "),s("code",[t._v("build")]),t._v(" folder directly from Caddy, such centralizing the admin but load balancing the backend APIs. The example for this is not shown, but it would likely be something you would build into your CI/CD platform.")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("Please note that this config is not focused on the frontend hosting, you will most likely need to adjust this to your frontend software requirements, it is only being shown here as an example.")])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("示例 API Domain: "),s("code",[t._v("example.com/api")])]),t._v(" "),s("p",[t._v("示例 Admin Domain: "),s("code",[t._v("example.com/dashboard")])]),t._v(" "),s("p",[s("strong",[t._v("Path —")]),t._v(" "),s("code",[t._v("/etc/caddy/Caddyfile")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("http://api.example.com {\n  root * /var/www\n  file_server\n  route /api* {\n    uri strip_prefix /api\n    reverse_proxy 127.0.0.1:1337\n  }\n  route /dashboard* {\n    reverse_proxy 127.0.0.1:1337\n  }\n}\n")])])])])],1),t._v(" "),s("h3",{attrs:{id:"strapi-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#strapi-server"}},[t._v("#")]),t._v(" Strapi Server")]),t._v(" "),s("p",[t._v("In order to take full advantage of a proxied Strapi application you will need to configure Strapi to make it aware of the upstream proxy. Like with the above Caddy configurations there are 3 matching examples. To read more about this server configuration file please see the "),s("RouterLink",{attrs:{to:"/developer-docs/latest/setup-deployment-guides/configurations.html#server"}},[t._v("server configuration")]),t._v(" documentation.")],1),t._v(" "),s("Tabs",{attrs:{type:"border-card"}},[s("Tab",{attrs:{label:"Sub-Domain"}},[s("h4",{attrs:{id:"sub-domain-strapi-config"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sub-domain-strapi-config"}},[t._v("#")]),t._v(" Sub-Domain Strapi config")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("示例 Domain: "),s("code",[t._v("api.example.com")])]),t._v(" "),s("p",[s("strong",[t._v("Path —")]),t._v(" "),s("code",[t._v("config/server.js")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  host"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HOST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PORT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://api.example.com'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("Tab",{attrs:{label:"Sub-Folder-Unified"}},[s("h4",{attrs:{id:"sub-folder-unified-strapi-config"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sub-folder-unified-strapi-config"}},[t._v("#")]),t._v(" Sub-Folder Unified Strapi config")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("示例 Domain: "),s("code",[t._v("example.com/api")])]),t._v(" "),s("p",[s("strong",[t._v("Path —")]),t._v(" "),s("code",[t._v("config/server.js")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  host"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HOST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PORT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://example.com/api'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("Tab",{attrs:{label:"Sub-Folder-Split"}},[s("h4",{attrs:{id:"sub-folder-split-strapi-config"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sub-folder-split-strapi-config"}},[t._v("#")]),t._v(" Sub-Folder Split Strapi config")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("示例 API Domain: "),s("code",[t._v("example.com/api")])]),t._v(" "),s("p",[t._v("示例 Admin Domain: "),s("code",[t._v("example.com/dashboard")])]),t._v(" "),s("p",[s("strong",[t._v("Path —")]),t._v(" "),s("code",[t._v("config/server.js")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  host"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HOST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PORT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://example.com/api'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  admin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://example.com/dashboard'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])],1)],1)}),[],!1,null,null,null);a.default=n.exports}}]);