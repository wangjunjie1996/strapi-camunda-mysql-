(window.webpackJsonp=window.webpackJsonp||[]).push([[1049],{1471:function(t,a,s){"use strict";s.r(a);var e=s(9),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"heroku"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#heroku"}},[t._v("#")]),t._v(" Heroku")]),t._v(" "),s("p",[t._v("This is a step-by-step guide for deploying a Strapi project on "),s("a",{attrs:{href:"https://www.heroku.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Heroku"),s("OutboundLink")],1),t._v(". Databases that work well with Strapi and Heroku are provided instructions on how to get started.")]),t._v(" "),s("h3",{attrs:{id:"heroku-install-requirements"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#heroku-install-requirements"}},[t._v("#")]),t._v(" Heroku Install Requirements")]),t._v(" "),s("ul",[s("li",[t._v("You must have "),s("a",{attrs:{href:"https://git-scm.com/book/en/v2/Getting-Started-First-Time-Git-Setup",target:"_blank",rel:"noopener noreferrer"}},[t._v("Git installed and set-up locally"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("li",[t._v("You must have a "),s("a",{attrs:{href:"https://signup.heroku.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("free Heroku account"),s("OutboundLink")],1),t._v(" before doing these steps.")])]),t._v(" "),s("p",[t._v("If you already have the Heroku CLI installed locally on your computer. Skip to "),s("a",{attrs:{href:"#_2-login-to-heroku-from-your-cli"}},[t._v("Login to Heroku")]),t._v(".")]),t._v(" "),s("h4",{attrs:{id:"_1-heroku-cli-installation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-heroku-cli-installation"}},[t._v("#")]),t._v(" 1. Heroku CLI Installation")]),t._v(" "),s("p",[t._v("Download and install the "),s("code",[t._v("Heroku CLI")]),t._v(" for your operating system:")]),t._v(" "),s("Tabs",{attrs:{type:"border-card"}},[s("Tab",{attrs:{label:"Ubuntu"}},[s("p",[t._v("Run the following from your terminal:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" snap "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --classic heroku\n")])])])]),t._v(" "),s("Tab",{attrs:{label:"Mac"}},[s("p",[s("a",{attrs:{href:"https://cli-assets.heroku.com/heroku.pkg",target:"_blank",rel:"noopener noreferrer"}},[t._v("Download the installer"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Also available via Homebrew:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("brew tap heroku/brew "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" brew "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" heroku\n")])])])]),t._v(" "),s("Tab",{attrs:{label:"Windows"}},[s("p",[t._v("Download the appropriate installer for your Windows installation:")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://cli-assets.heroku.com/heroku-x64.exe",target:"_blank",rel:"noopener noreferrer"}},[t._v("64-bit installer"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://cli-assets.heroku.com/heroku-x86.exe",target:"_blank",rel:"noopener noreferrer"}},[t._v("32-bit installer"),s("OutboundLink")],1)])])])],1),t._v(" "),s("h4",{attrs:{id:"_2-login-to-heroku-from-your-cli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-login-to-heroku-from-your-cli"}},[t._v("#")]),t._v(" 2. Login to Heroku from your CLI")]),t._v(" "),s("p",[t._v("Next, you need to login to Heroku from your computer.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("heroku login\n")])])]),s("p",[t._v("Follow the instructions and return to your command line.")]),t._v(" "),s("h4",{attrs:{id:"_3-create-a-new-project-or-use-an-existing-one"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-create-a-new-project-or-use-an-existing-one"}},[t._v("#")]),t._v(" 3. Create a new project (or use an existing one)")]),t._v(" "),s("p",[t._v("Create a "),s("RouterLink",{attrs:{to:"/developer-docs/latest/getting-started/quick-start.html"}},[t._v("new Strapi project")]),t._v(" (if you want to deploy an existing project go to step 4).")],1),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("If you plan to use "),s("strong",[t._v("MongoDB")]),t._v(" with your project, "),s("RouterLink",{attrs:{to:"/developer-docs/latest/setup-deployment-guides/configurations/databases/mongodb.html#install-mongodb-locally"}},[t._v("refer to the create a Strapi project with MongoDB section of the 文章")]),t._v(" then, jump to step 4.")],1)]),t._v(" "),s("p",[s("code",[t._v("Path: ./")])]),t._v(" "),s("Tabs",{attrs:{type:"border-card"}},[s("Tab",{attrs:{label:"yarn"}},[s("p",[t._v("Use "),s("strong",[t._v("yarn")]),t._v(" to install the Strapi project ("),s("strong",[t._v("recommended")]),t._v("). "),s("a",{attrs:{href:"https://yarnpkg.com/lang/en/docs/install/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Install yarn with these docs"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" create strapi-app my-project --quickstart\n")])])])]),t._v(" "),s("Tab",{attrs:{label:"npx"}},[s("p",[t._v("Use "),s("strong",[t._v("npm/npx")]),t._v(" to install the Strapi project")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("npx create-strapi-app my-project --quickstart\n")])])])])],1),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("When you use "),s("code",[t._v("--quickstart")]),t._v(" to create a Strapi project locally, a "),s("strong",[t._v("SQLite database")]),t._v(" is used which is not compatible with Heroku. Therefore, another database option "),s("a",{attrs:{href:"#_7-heroku-database-set-up"}},[t._v("must be chosen")]),t._v(".")])]),t._v(" "),s("h4",{attrs:{id:"_4-update-gitignore"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-update-gitignore"}},[t._v("#")]),t._v(" 4. Update "),s("code",[t._v(".gitignore")])]),t._v(" "),s("p",[t._v("Add the following line at end of "),s("code",[t._v(".gitignore")]),t._v(":")]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/.gitignore")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("package-lock.json\n")])])]),s("p",[t._v("Even if it is usually recommended to version this file, it may create issues on Heroku.")]),t._v(" "),s("h4",{attrs:{id:"_5-init-a-git-repository-and-commit-your-project"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-init-a-git-repository-and-commit-your-project"}},[t._v("#")]),t._v(" 5. Init a Git repository and commit your project")]),t._v(" "),s("p",[t._v("Init the Git repository and commit your project.")]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" my-project\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" init\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Initial Commit"')]),t._v("\n")])])]),s("h4",{attrs:{id:"_6-create-a-heroku-project"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-create-a-heroku-project"}},[t._v("#")]),t._v(" 6. Create a Heroku project")]),t._v(" "),s("p",[t._v("Create a new Heroku project.")]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("heroku create\n")])])]),s("p",[t._v("You can use "),s("code",[t._v("heroku create custom-project-name")]),t._v(", to have Heroku create a "),s("code",[t._v("custom-project-name.heroku.com")]),t._v(" URL. Otherwise, Heroku will automatically generate a random project name (and URL) for you.")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("If you have a Heroku project app already created. You would use the following step to initialize your local project folder:")]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/")]),t._v("")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("heroku git:remote -a your-heroku-app-name\n")])])])]),t._v(" "),s("p",[t._v("Your local development environment is now set-up and configured to work with Heroku. You have a new Strapi project and a new Heroku app ready to be configured to work with a database and with each other.")]),t._v(" "),s("h4",{attrs:{id:"_7-heroku-database-set-up"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-heroku-database-set-up"}},[t._v("#")]),t._v(" 7. Heroku Database set-up")]),t._v(" "),s("p",[t._v("Below you will find database options when working with Heroku. Please choose the correct database (e.g. PostgreSQL, MongoDB, etc.) and follow those instructions.")]),t._v(" "),s("Tabs",{attrs:{type:"border-card"}},[s("Tab",{attrs:{label:"PostgreSQL"}},[s("h3",{attrs:{id:"heroku-postgres"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#heroku-postgres"}},[t._v("#")]),t._v(" Heroku Postgres")]),t._v(" "),s("p",[t._v("Follow these steps to deploy your Strapi app to Heroku using "),s("strong",[t._v("PostgreSQL")]),t._v(":")]),t._v(" "),s("h4",{attrs:{id:"_1-install-the-heroku-postgres-addon-for-using-postgres"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-install-the-heroku-postgres-addon-for-using-postgres"}},[t._v("#")]),t._v(" 1. Install the "),s("a",{attrs:{href:"https://elements.heroku.com/addons/heroku-postgresql",target:"_blank",rel:"noopener noreferrer"}},[t._v("Heroku Postgres addon"),s("OutboundLink")],1),t._v(" for using Postgres.")]),t._v(" "),s("p",[t._v('To make things even easier, Heroku provides a powerful addon system. In this section, you are going to use the Heroku Postgres addon, which provides a free "Hobby Dev" plan. If you plan to deploy your app in production, it is highly recommended switching to a paid plan.')]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("heroku addons:create heroku-postgresql:hobby-dev\n")])])]),s("h4",{attrs:{id:"_2-retrieve-database-credentials"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-retrieve-database-credentials"}},[t._v("#")]),t._v(" 2. Retrieve database credentials")]),t._v(" "),s("p",[t._v("The add-on automatically exposes the database credentials into a single environment variable accessible by your app. To retrieve it, type:")]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("heroku config\n")])])]),s("p",[t._v("This should print something like this: "),s("code",[t._v("DATABASE_URL: postgres://ebitxebvixeeqd:dc59b16dedb3a1eef84d4999sb4baf@ec2-50-37-231-192.compute-2.amazonaws.com: 5432/d516fp1u21ph7b")]),t._v(".")]),t._v(" "),s("p",[t._v("(This url is read like so: *postgres:// "),s("strong",[t._v("USERNAME")]),t._v(" : "),s("strong",[t._v("PASSWORD")]),t._v(" @ "),s("strong",[t._v("HOST")]),t._v(" : "),s("strong",[t._v("PORT")]),t._v(" : "),s("strong",[t._v("DATABASE_NAME*")]),t._v(")")]),t._v(" "),s("h4",{attrs:{id:"_3-set-database-variables-automatically"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-set-database-variables-automatically"}},[t._v("#")]),t._v(" 3. Set Database variables automatically")]),t._v(" "),s("p",[t._v("Strapi expects a variable for each database connection configuration (host, username, etc.). So, from the url above, Strapi will deconstruct that environment variable using "),s("a",{attrs:{href:"https://www.npmjs.com/package/pg-connection-string",target:"_blank",rel:"noopener noreferrer"}},[t._v("pg-connection-string"),s("OutboundLink")],1),t._v(" package. Heroku will sometimes change the above url, so it's best to automate the deconstruction of it, as Heroku will automatically update the "),s("code",[t._v("DATABASE_URL")]),t._v(" environment variable.")]),t._v(" "),s("p",[t._v("Install the package:")]),t._v(" "),s("p",[t._v("With npm:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" pg-connection-string --save\n")])])]),s("p",[t._v("With yarn:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" pg-connection-string\n")])])]),s("h4",{attrs:{id:"_4-create-your-heroku-database-config-file-for-production"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-create-your-heroku-database-config-file-for-production"}},[t._v("#")]),t._v(" 4. Create your Heroku database config file for production")]),t._v(" "),s("p",[t._v("Create new subfolders in "),s("code",[t._v("./config")]),t._v(" like so: "),s("code",[t._v("/[env]/production")]),t._v(", then create a new "),s("code",[t._v("database.js")]),t._v(" in iti (see "),s("RouterLink",{attrs:{to:"/developer-docs/latest/setup-deployment-guides/configurations.html#environment"}},[t._v("environment 文章")]),t._v("). Your path should look like this: "),s("code",[t._v("./config/env/production/database.js")]),t._v(". When you run locally you should be using the "),s("code",[t._v("./config/database.js")]),t._v(" which could be set to use SQLite, however it's recommended you use PostgreSQL locally also, for information on configuring your local database, please see the "),s("RouterLink",{attrs:{to:"/developer-docs/latest/setup-deployment-guides/configurations.html#database"}},[t._v("database 文章")]),t._v(".")],1),t._v(" "),s("p",[s("code",[t._v("Path: ./config/env/production/database.js")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" parse "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pg-connection-string'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DATABASE_URL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  defaultConnection"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  connections"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      connector"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bookshelf'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      settings"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        client"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'postgres'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        host"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        database"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        ssl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          rejectUnauthorized"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      options"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ssl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("You also need to set the "),s("code",[t._v("NODE_ENV")]),t._v(" variable on Heroku to "),s("code",[t._v("production")]),t._v(" to ensure this new database configuration file is used.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("heroku config:set "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("NODE_ENV")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("production\n")])])]),s("h4",{attrs:{id:"_5-create-your-strapi-server-config-for-production"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-create-your-strapi-server-config-for-production"}},[t._v("#")]),t._v(" 5. Create your Strapi server config for production")]),t._v(" "),s("p",[t._v("Create a new "),s("code",[t._v("server.js")]),t._v(" in a new "),s("RouterLink",{attrs:{to:"/developer-docs/latest/setup-deployment-guides/configurations.html#environment"}},[t._v("env")]),t._v(" folder. In this file you only need one key, the "),s("code",[t._v("url")]),t._v(", to notify Strapi what our public Heroku domain is. All other settings will automatically be pulled from the default "),s("code",[t._v("./config/server.js")]),t._v(".")],1),t._v(" "),s("p",[s("code",[t._v("Path: ./config/env/production/server.js")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HEROKU_URL'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("You will also need to set the environment variable in Heroku for the "),s("code",[t._v("HEROKU_URL")]),t._v(". This will populate the variable with something like "),s("code",[t._v("https://your-app.herokuapp.com")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("heroku config:set "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("HEROKU_URL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("heroku info -s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" web_url "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cut")]),t._v(" -d"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" -f2"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n")])])]),s("h4",{attrs:{id:"_6-install-the-pg-node-module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-install-the-pg-node-module"}},[t._v("#")]),t._v(" 6. Install the "),s("code",[t._v("pg")]),t._v(" node module")]),t._v(" "),s("p",[t._v("Unless you originally installed Strapi with PostgreSQL, you need to install the "),s("a",{attrs:{href:"https://www.npmjs.com/package/pg",target:"_blank",rel:"noopener noreferrer"}},[t._v("pg"),s("OutboundLink")],1),t._v(" node module.")]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" pg --save\n")])])])]),t._v(" "),s("Tab",{attrs:{label:"MongoDB"}},[s("h3",{attrs:{id:"mongodb-atlas"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-atlas"}},[t._v("#")]),t._v(" MongoDB Atlas")]),t._v(" "),s("p",[t._v("(Using Strapi and MongoDB requires different set-up and different configuration steps. You cannot use "),s("code",[t._v("--quickstart")]),t._v(" to develop a "),s("code",[t._v("MongoDB")]),t._v(" Strapi project.)")]),t._v(" "),s("p",[t._v("Please follow these steps the "),s("strong",[t._v("deploy a Strapi app with MongoDB on Heroku")]),t._v(".")]),t._v(" "),s("p",[t._v("You must have completed the "),s("RouterLink",{attrs:{to:"/developer-docs/latest/setup-deployment-guides/configurations/databases/mongodb.html#install-on-atlas-mongodb-atlas"}},[t._v("steps to use Strapi with MongoDB Atlas")]),t._v(" - through "),s("strong",[t._v("4. Retrieve database credentials")]),t._v(".")],1),t._v(" "),s("h4",{attrs:{id:"_1-set-environment-variables"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-set-environment-variables"}},[t._v("#")]),t._v(" 1. Set environment variables")]),t._v(" "),s("p",[t._v("When you "),s("RouterLink",{attrs:{to:"/developer-docs/latest/setup-deployment-guides/configurations/databases/mongodb.html#install-on-atlas-mongodb-atlas"}},[t._v("set-up your MongoDB Atlas database")]),t._v(" you noted a connection string. Similar to this:")],1),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("mongodb://paulbocuse:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("@strapidatabase-shard-00-00-fxxx6c.mongodb.net:27017,strapidatabase-shard-00-01-fxxxc.mongodb.net:27017,strapidatabase-shard-00-02-fxxxc.mongodb.net:27017/test?ssl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("replicaSet")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("strapidatabase-shard-0"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("authSource")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("retryWrites")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("w")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("majority\n\n")])])]),s("p",[t._v("So, from "),s("strong",[t._v("MongoDB Atlas")]),t._v(", you have to set two environment variables in the Heroku config (for "),s("strong",[t._v("DATABASE_URI")]),t._v(" and "),s("strong",[t._v("DATABASE_NAME")]),t._v("). Set the environment variables using the following commands:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("heroku config:set "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DATABASE_URI")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongodb://paulbocuse:<password>@strapidatabase-shard-00-00-fxxx6c.mongodb.net:27017,strapidatabase-shard-00-01-fxxxc.mongodb.net:27017,strapidatabase-shard-00-02-fxxxc.mongodb.net:27017/test?ssl=true&replicaSet=strapidatabase-shard-0&authSource=admin&retryWrites=true&w=majority"')]),t._v("\nheroku config:set "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DATABASE_NAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-database-name"')]),t._v("\n")])])]),s("p",[t._v("Please replace the "),s("code",[t._v("<password>")]),t._v(" and "),s("code",[t._v("my-database-name")]),t._v(" values with the your actual values.")]),t._v(" "),s("h4",{attrs:{id:"_2-update-your-database-config-file"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-update-your-database-config-file"}},[t._v("#")]),t._v(" 2. Update your database config file")]),t._v(" "),s("p",[s("code",[t._v("Path: ./config/database.js")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  defaultConnection"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  connections"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      connector"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mongoose'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      settings"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        uri"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DATABASE_URI'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      options"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ssl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("If you need to configure the connection differently (e.g using "),s("code",[t._v("host")]),t._v(","),s("code",[t._v("port")]),t._v("...) you should set the default database config like so:")]),t._v(" "),s("p",[s("code",[t._v("Path: ./config/database.js")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  defaultConnection"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  connections"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      connector"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mongoose'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      settings"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      options"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Then set the development and the production configurations separately:")]),t._v(" "),s("p",[s("code",[t._v("Path: ./config/env/development/database.js")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  defaultConnection"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  connections"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      connector"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mongoose'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      settings"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        host"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DATABASE_HOST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DATABASE_PORT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        database"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DATABASE_NAME'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DATABASE_USERNAME'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DATABASE_PASSWORD'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      options"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("and finally for the "),s("code",[t._v("production")]),t._v(" env:")]),t._v(" "),s("p",[s("code",[t._v("Path: ./config/env/production/database.js")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  defaultConnection"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  connections"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      connector"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mongoose'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      settings"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        uri"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DATABASE_URI'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      options"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ssl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])],1),t._v(" "),s("h4",{attrs:{id:"_8-commit-your-changes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-commit-your-changes"}},[t._v("#")]),t._v(" 8. Commit your changes")]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Update database config"')]),t._v("\n")])])]),s("h4",{attrs:{id:"_9-update-yarn-lockfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-update-yarn-lockfile"}},[t._v("#")]),t._v(" 9. Update Yarn lockfile")]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),s("h4",{attrs:{id:"_10-commit-your-changes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-commit-your-changes"}},[t._v("#")]),t._v(" 10. Commit your changes")]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" yarn.lock\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Updated Yarn lockfile"')]),t._v("\n")])])]),s("h4",{attrs:{id:"_11-deploy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-deploy"}},[t._v("#")]),t._v(" 11. Deploy")]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push heroku HEAD:main\n")])])]),s("p",[t._v("The deployment may take a few minutes. At the end, logs will display the url of your project (e.g. "),s("code",[t._v("https://mighty-taiga-80884.herokuapp.com")]),t._v("). You can also open your project using the command line:")]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("heroku "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),t._v("\n")])])]),s("p",[t._v("If you see the Strapi Welcome page, you have correctly set-up, configured and deployed your Strapi project on Heroku. You will now need to set-up your "),s("code",[t._v("admin user")]),t._v(" as the production database is brand-new (and empty).")]),t._v(" "),s("p",[t._v("You can now continue with the "),s("RouterLink",{attrs:{to:"/developer-docs/latest/getting-started/quick-start.html#_2-create-an-administrator-user"}},[t._v("Tutorial - Creating an Admin User")]),t._v(", if you have any questions on how to proceed.")],1),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("For security reasons, the Content Type Builder plugin is disabled in production. To update content structure, please make your changes locally and deploy again.")])]),t._v(" "),s("h3",{attrs:{id:"project-updates"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#project-updates"}},[t._v("#")]),t._v(" Project updates")]),t._v(" "),s("p",[t._v("When Strapi is deployed to Heroku, Heroku sets the environment variable to "),s("code",[t._v("NODE_ENV=production")]),t._v(". In "),s("code",[t._v("production mode")]),t._v(" Strapi disables the content-type builder (for security reasons). Additionally, if you wanted to change the default production mode in Heroku, it wouldn't work as the file system is temporary. Strapi writes files to the server when you update the content-types and these updates would disappear when Heroku restarts the server.")]),t._v(" "),s("p",[t._v("Therefore, modifications that require writing to model creation or other json files, e.g. creating or changing content-types, require that you make those changes on your dev environment and then push the changes to Heroku.")]),t._v(" "),s("p",[t._v("As you continue developing your application with Strapi, you may want to use "),s("a",{attrs:{href:"https://devcenter.heroku.com/articles/github-integration",target:"_blank",rel:"noopener noreferrer"}},[t._v("version control"),s("OutboundLink")],1),t._v(", or you can continue to use "),s("code",[t._v("git push heroku HEAD:main")]),t._v(" to commit and push changes to Heroku directly.")]),t._v(" "),s("p",[s("code",[t._v("Path: ./my-project/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -am "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Changes to my-project noted"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push heroku HEAD:main\nheroku "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),t._v("\n")])])]),s("h3",{attrs:{id:"file-uploads"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#file-uploads"}},[t._v("#")]),t._v(" File Uploads")]),t._v(" "),s("p",[t._v('Like with project updates on Heroku, the file system doesn\'t support local uploading of files as they will be wiped when Heroku "Cycles" the dyno. This type of file system is called '),s("a",{attrs:{href:"https://devcenter.heroku.com/articles/dynos#ephemeral-filesystem",target:"_blank",rel:"noopener noreferrer"}},[t._v("ephemeral"),s("OutboundLink")],1),t._v(", which means the file system only lasts until the dyno is restarted (with Heroku this happens any time you redeploy or during their regular restart which can happen every few hours or every day).")]),t._v(" "),s("p",[t._v("Due to Heroku's filesystem you will need to use an upload provider such as AWS S3, Cloudinary, or Rackspace. You can view the documentation for installing providers "),s("RouterLink",{attrs:{to:"/developer-docs/latest/development/plugins/upload.html#create-providers"}},[t._v("这里")]),t._v(" and you can see a list of providers from both Strapi and the community on "),s("a",{attrs:{href:"https://www.npmjs.com/search?q=strapi-provider-upload-&page=0&perPage=20",target:"_blank",rel:"noopener noreferrer"}},[t._v("npmjs.com"),s("OutboundLink")],1),t._v(".")],1),t._v(" "),s("h3",{attrs:{id:"gzip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gzip"}},[t._v("#")]),t._v(" Gzip")]),t._v(" "),s("p",[t._v("As of version "),s("code",[t._v("3.2.1")]),t._v(", Strapi uses "),s("a",{attrs:{href:"https://github.com/koajs/compress",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("koa-compress")]),s("OutboundLink")],1),t._v(" v5, which enables "),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Brotli",target:"_blank",rel:"noopener noreferrer"}},[t._v("Brotli"),s("OutboundLink")],1),t._v(" compression by default. At the time of writing, the default configuration for Brotli results in poor performance, causing very slow response times and potentially response timeouts. If you plan on enabling the "),s("RouterLink",{attrs:{to:"/developer-docs/latest/setup-deployment-guides/configurations.html#core-middleware-configurations"}},[t._v("gzip middleware")]),t._v(", it is recommended that you disable Brotli or define better configuration params.")],1),t._v(" "),s("p",[t._v("To disable Brotli, provide the following configuration in "),s("code",[t._v("config/middleware.js")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-jsonify extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("gzip: {\n  enabled: true,\n  options: {\n    br: false\n  }\n},\n")])])]),s("p",[t._v("For more on Brotli configuration for "),s("code",[t._v("koa-compress")]),t._v(", reference "),s("a",{attrs:{href:"https://github.com/koajs/compress/issues/121",target:"_blank",rel:"noopener noreferrer"}},[t._v("this issue"),s("OutboundLink")],1),t._v(".")])],1)}),[],!1,null,null,null);a.default=n.exports}}]);