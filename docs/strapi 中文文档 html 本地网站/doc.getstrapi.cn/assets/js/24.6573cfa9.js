(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{1435:function(e,t,n){"use strict";n.r(t);var a=n(9),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"api-文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api-文档"}},[e._v("#")]),e._v(" API 文档")]),e._v(" "),a("p",[e._v("Now that you have created your API it's really important to document its available end-points. The documentation plugin takes out most of your pain to generate your documentation. This plugin uses "),a("a",{attrs:{href:"https://swagger.io/solutions/api-documentation/",target:"_blank",rel:"noopener noreferrer"}},[e._v("SWAGGER UI"),a("OutboundLink")],1),e._v(" to visualize your API's documentation.")]),e._v(" "),a("p",[e._v("If installed, this plugin will scan all the routes available from your "),a("code",[e._v("./api")]),e._v(" folder and will try to create the appropriate documentation, infer on the parameters needed to create data, the responses you will receive.")]),e._v(" "),a("p",[e._v("You'll be able to visualize all your end-points directly from the SWAGGER UI.")]),e._v(" "),a("h2",{attrs:{id:"installation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[e._v("#")]),e._v(" Installation")]),e._v(" "),a("p",[e._v("As usual run the following in your terminal:")]),e._v(" "),a("Tabs",{attrs:{type:"border-card"}},[a("Tab",{attrs:{label:"yarn"}},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("yarn strapi install documentation\n")])])])]),e._v(" "),a("Tab",{attrs:{label:"npm"}},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("npm run strapi install documentation\n")])])])]),e._v(" "),a("Tab",{attrs:{label:"strapi"}},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("strapi install documentation\n")])])])])],1),e._v(" "),a("p",[e._v("When your plugin is installed, you just have to start your application and it will generate your API documentation.")]),e._v(" "),a("p",[e._v("The administration panel lets you configure the basic settings of this plugin.")]),e._v(" "),a("p",[a("img",{attrs:{src:n(392),alt:"Accessing the 文章"}})]),e._v(" "),a("h2",{attrs:{id:"administration-panel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#administration-panel"}},[e._v("#")]),e._v(" Administration panel")]),e._v(" "),a("p",[e._v("This plugin comes with an interface that is available in your administration panel and a configuration file.")]),e._v(" "),a("h3",{attrs:{id:"restrict-the-access-to-your-api-s-documentation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#restrict-the-access-to-your-api-s-documentation"}},[e._v("#")]),e._v(" Restrict the access to your API's documentation")]),e._v(" "),a("p",[e._v("By default, your documentation will be accessible by anyone.")]),e._v(" "),a("p",[e._v("If you want to restrict the access to the documentation you have to enable the "),a("strong",[e._v("Restricted Access")]),e._v(" option.")]),e._v(" "),a("ul",[a("li",[e._v("点击 "),a("code",[e._v("ON")]),e._v(" of "),a("strong",[e._v("Restricted Access")])]),e._v(" "),a("li",[e._v("Select a password in the "),a("code",[e._v("password")]),e._v(" input")]),e._v(" "),a("li",[e._v("Save your settings")])]),e._v(" "),a("p",[e._v("Now if you try to access your documentation, you will have to enter the password you set.")]),e._v(" "),a("h3",{attrs:{id:"retrieve-your-jwt-token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#retrieve-your-jwt-token"}},[e._v("#")]),e._v(" Retrieve your JWT token")]),e._v(" "),a("p",[e._v("Strapi is secured by default which means that most of your end-points require your user to be authorized. You will need to paste this token in your SWAGGER UI to try out your end-points.")]),e._v(" "),a("ul",[a("li",[e._v("点击 the "),a("strong",[e._v("Retrieve your jwt token")]),e._v(" input to copy the token")]),e._v(" "),a("li",[e._v("Visit your documentation")]),e._v(" "),a("li",[e._v("点击 the "),a("strong",[e._v("Authorize")]),e._v(" button on the right")]),e._v(" "),a("li",[e._v("Past your token in the "),a("code",[e._v("value")]),e._v(" input")])]),e._v(" "),a("h3",{attrs:{id:"regenerate-a-documentation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#regenerate-a-documentation"}},[e._v("#")]),e._v(" Regenerate a documentation")]),e._v(" "),a("p",[e._v("If you update your API, the documentation will not be updated automatically.\nYou will have to click on the "),a("strong",[e._v("Regenerate")]),e._v(" button of the documentation version you want to update.\nIt will regenerated to specified version with the current API documentation.")]),e._v(" "),a("h2",{attrs:{id:"settings"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#settings"}},[e._v("#")]),e._v(" Settings")]),e._v(" "),a("p",[e._v("You need to create the "),a("code",[e._v("./extensions/documentation/config/settings.json")]),e._v(" file manually to customize the swagger ui settings.")]),e._v(" "),a("p",[e._v("Here are the file that needs to be created in order to change the documentation version, the server URL and so on.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('{\n  "openapi": "3.0.0",\n  "info": {\n    "version": "1.0.0",\n    "title": "DOCUMENTATION",\n    "description": "",\n    "termsOfService": "YOUR_TERMS_OF_SERVICE_URL",\n    "contact": {\n      "name": "TEAM",\n      "email": "contact-email@something.io",\n      "url": "mywebsite.io"\n    },\n    "license": {\n      "name": "Apache 2.0",\n      "url": "https://www.apache.org/licenses/LICENSE-2.0.html"\n    }\n  },\n  "x-strapi-config": {\n    "path": "/documentation",\n    "showGeneratedFiles": true,\n    "pluginsForWhichToGenerateDoc": [\n      "email",\n      "upload",\n      "users-permissions"\n    ]\n  },\n  "servers": [\n    {\n      "url": "http://localhost:1337",\n      "description": "Development server"\n    },\n    {\n      "url": "YOUR_STAGING_SERVER",\n      "description": "Staging server"\n    },\n    {\n      "url": "YOUR_PRODUCTION_SERVER",\n      "description": "Production server"\n    }\n  ],\n  "externalDocs": {\n    "description": "Find out more",\n    "url": "https://strapi.io/documentation/"\n  },\n  "security": [\n    {\n      "bearerAuth": []\n    }\n  ],\n  "paths": {},\n  "tags": [],\n  "components": {}\n}\n')])])]),a("p",[e._v("The "),a("code",[e._v("openapi")]),e._v(", "),a("code",[e._v("info")]),e._v(", "),a("code",[e._v("x-strapi-config")]),e._v(", "),a("code",[e._v("servers")]),e._v(", "),a("code",[e._v("externalDocs")]),e._v(" and "),a("code",[e._v("security")]),e._v(" fields are located in the "),a("code",[e._v("./extensions/documentation/config/settings.json")]),e._v(" file. Here you can specify all your environment variables, licenses, external documentation and so on...\nYou can add all the entries listed in the "),a("a",{attrs:{href:"https://swagger.io/specification/",target:"_blank",rel:"noopener noreferrer"}},[e._v("specification"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),a("p",[e._v("Do not change the "),a("code",[e._v("openapi")]),e._v(" field of the "),a("code",[e._v("settings.json")])])]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("注意")]),e._v(" "),a("p",[e._v("When you change a field in the settings.json file you need to manually restart your server.")])]),e._v(" "),a("h3",{attrs:{id:"create-a-new-version-of-the-documentation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-new-version-of-the-documentation"}},[e._v("#")]),e._v(" Create a new version of the documentation")]),e._v(" "),a("p",[e._v("To create a new version of your documentation, you will have to update the "),a("code",[e._v("version")]),e._v(" key.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('{\n  "info": {\n    "version": "2.0.0"\n  }\n}\n')])])]),a("h3",{attrs:{id:"change-the-documentation-path"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#change-the-documentation-path"}},[e._v("#")]),e._v(" Change the documentation path")]),e._v(" "),a("p",[e._v("To access your documentation on a custom path, you will have to update the "),a("code",[e._v("path")]),e._v(" key.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('{\n  "x-strapi-config": {\n    "path": "/documentation"\n  }\n}\n')])])]),a("h3",{attrs:{id:"indicate-which-plugins-documentation-to-generate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#indicate-which-plugins-documentation-to-generate"}},[e._v("#")]),e._v(" Indicate which plugins' documentation to generate")]),e._v(" "),a("p",[e._v("To generate documentation for specific plugins, you will need to indicate the list of all the plugins for which you wish to generate documentation. In order to do that you need to update the "),a("code",[e._v("pluginsForWhichToGenerateDoc")]),e._v(" key. Leaving this key with an empty array "),a("code",[e._v("[]")]),e._v(" means that not any plugin documentation will be generated. If you wish to generate documentation for all plugins, you just have to remove the key from the "),a("code",[e._v("settings.json")]),e._v(" file.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('{\n  "x-strapi-config": {\n    "pluginsForWhichToGenerateDoc": [\n      "email",\n      "upload",\n      "users-permissions"\n    ],\n  }\n}\n')])])]),a("p",[e._v("In the previous example, you will generate documentation for the upload, email and users permissions (permissions and roles) plugins.")]),e._v(" "),a("h3",{attrs:{id:"default-response"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#default-response"}},[e._v("#")]),e._v(" Default Response")]),e._v(" "),a("p",[e._v("Sometimes, an operation can return multiple errors with different HTTP status codes, but all of them have the same response structure. You can use the default response to describe these errors collectively, not individually. “Default” means this response is used for all HTTP codes that are not covered individually for this operation.")]),e._v(" "),a("p",[e._v("This is how it would looks like")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("responses:\n        '200':\n          description: Success\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/User'\n        # Definition of all error statuses\n        default:\n          description: Unexpected error\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n")])])]),a("p",[e._v("You can set the generation of the default response with the following attribute "),a("code",[e._v("generateDefaultResponse")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('{\n  "x-strapi-config": {\n    "generateDefaultResponse": true\n  }\n}\n')])])]),a("p",[e._v("Note: this is configurable as some API Gateways does not support a default response.")]),e._v(" "),a("h2",{attrs:{id:"file-structure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#file-structure"}},[e._v("#")]),e._v(" File structure")]),e._v(" "),a("p",[e._v("This plugin follows the OpenApi Specifications ("),a("a",{attrs:{href:"https://swagger.io/specification/",target:"_blank",rel:"noopener noreferrer"}},[e._v("0AS.3.0.2"),a("OutboundLink")],1),e._v(") and generates an OpenAPI Document called "),a("code",[e._v("full_documentation.json")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"plugin-s-architecture"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#plugin-s-architecture"}},[e._v("#")]),e._v(" Plugin's architecture")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("./extensions\n└─── documentation\n    |\n    └─── documentation // Folder containing your OpenAPI Documents\n         └─── 1.0.0 // OpenAPI Document's version\n         | └─── full_documentation.json // OpenAPI Document used by SWAGGER UI\n         |\n         └─── 2.0.0\n           └─── full_documentation.json\n")])])]),a("h3",{attrs:{id:"generated-files"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#generated-files"}},[e._v("#")]),e._v(" Generated files")]),e._v(" "),a("p",[e._v("When you start your server with this plugin installed it will automatically create the following files in your APIs (we will see how it works for the plugins). The plugin scans all the routes available in your model to create the "),a("code",[e._v("paths")]),e._v(" 字段")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("/my-strapi-project\n  └─── api\n        └─── Foo\n            └── documentation // Folder added to your model\n                └── 1.0.0\n                    └── foo.json // File containing all the paths where the responses can be inferred\n                    └── unclassified.json // File containing the manually added route of your `routes.json` file\n                    |\n                    └── overrides // (Optional) Folder to override the generated documentation\n")])])]),a("h2",{attrs:{id:"overriding-the-suggested-documentation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#overriding-the-suggested-documentation"}},[e._v("#")]),e._v(" Overriding the suggested documentation")]),e._v(" "),a("p",[e._v("Currently the plugin writes a json file for each API.")]),e._v(" "),a("p",[e._v("In order to customize the responses or to add information to a path you need to create a file in the associated "),a("code",[e._v("overrides/<file-name>.json")]),e._v(" (the name of the file matters so make sure they are similar). Then you just need to identify the path you want to modify.\nYou can modify the default generated tags by adding a new one at the end of the file, it works the same way for the components.")]),e._v(" "),a("p",[a("strong",[a("em",[e._v("NOTE 1")])])]),e._v(" "),a("p",[e._v("Overriding the "),a("code",[e._v("full_documentation.json")]),e._v(" is a bad idea since it will be regenerated each time you change a model.")]),e._v(" "),a("p",[a("strong",[a("em",[e._v("NOTE 2")])])]),e._v(" "),a("p",[e._v("You can easily modify the description, summary, parameters of a path however, for a response like the "),a("code",[e._v("200")]),e._v(" you will need to write the full object. Take a look at the "),a("code",[e._v("./extensions/users-permissions/documentation/1.0.0/overrides/users-permissions-User.json")]),e._v(" for a complete example.")]),e._v(" "),a("p",[a("strong",[a("em",[e._v("NOTE 3")])])]),e._v(" "),a("p",[e._v("To modify your generated swagger files security on a specific model, for example to allow the public to use it, you will need to override the security for each path's action. For example with the route "),a("code",[e._v("/comments/count")]),e._v(" typically all routes are protected by strapi, however if you allow the public role to use this without authentication you will need to override it in your model. See the below example:")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[e._v("    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"/comments/count"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"get"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"security"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n")])])]),a("p",[e._v('As you can see in that example, you are defining "no security" whereas normally you would need a bearer token to access. You will need to do this manually as the documentation plugin rewrites files and cannot pull permissions from the database as this would require a server restart each time the docs are updated.')]),e._v(" "),a("h2",{attrs:{id:"faq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#faq"}},[e._v("#")]),e._v(" FAQ")]),e._v(" "),a("h3",{attrs:{id:"how-does-it-generate-the-other-plugins-documentation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-does-it-generate-the-other-plugins-documentation"}},[e._v("#")]),e._v(" How does it generate the other plugins' documentation?")]),e._v(" "),a("p",[e._v("In order to display a plugin's end-point in the documentation you need to add a "),a("code",[e._v("description")]),e._v(" key in the "),a("code",[e._v("config")]),e._v(" object.")]),e._v(" "),a("p",[e._v("For example this is the plugin email "),a("code",[e._v("routes.json")]),e._v(" file:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('{\n  "routes": [\n    {\n      "method": "POST",\n      "path": "/",\n      "handler": "Email.send",\n      "config": {\n        "policies": [],\n        "description": "Send an email",\n        "tag": {\n          "plugin": "email",\n          "name": "Email"\n        }\n      }\n    },\n    {\n      "method": "GET",\n      "path": "/environments",\n      "handler": "Email.getEnvironments",\n      "config": {\n        "policies": []\n      }\n    },\n    {\n      "method": "GET",\n      "path": "/settings/:environment",\n      "handler": "Email.getSettings",\n      "config": {\n        "policies": []\n      }\n    },\n    {\n      "method": "PUT",\n      "path": "/settings/:environment",\n      "handler": "Email.updateSettings",\n      "config": {\n        "policies": []\n      }\n    }\n  ]\n}\n')])])]),a("p",[e._v("In this file we have only one route that we want to reference in our documentation ("),a("code",[e._v("/")]),e._v("). Usually, the tag object is used for the SWAGGER UI, it will group this route under the "),a("code",[e._v("Email - Email")]),e._v(" dropdown in the documentation. Furthermore, the algorithm will try to find the model to generate the best response possible. If the model is unknown it generates a response like the following "),a("code",[e._v('{ foo: "string" }')]),e._v(" that you can easily override later.")]),e._v(" "),a("p",[e._v("There's another property to guide the algorithm to create the best response possible, the "),a("code",[e._v("actionType")]),e._v(" key.\nWhen we can't know by the controller name the type of the returned response (like "),a("code",[e._v("find")]),e._v(" and "),a("code",[e._v("findOne")]),e._v(") you can specify it with this key. Here's an example from the "),a("code",[e._v("users-permissions")]),e._v(" route file.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('{\n  "method": "GET",\n  "path": "/users/me",\n  "handler": "User.me",\n  "config": {\n    "policies": [],\n    "prefix": "",\n    "description": "Retrieve the logged in user information",\n    "tag": {\n      "plugin": "users-permissions",\n      "name": "User",\n      "actionType": "findOne"\n    }\n  }\n}\n')])])]),a("h3",{attrs:{id:"i-have-created-a-route-in-a-common-api-like-product-that-queries-another-model-how-to-automate-this"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#i-have-created-a-route-in-a-common-api-like-product-that-queries-another-model-how-to-automate-this"}},[e._v("#")]),e._v(" I have created a route in a common API (like product) that queries another model. How to automate this ?")]),e._v(" "),a("p",[e._v("You can use the "),a("code",[e._v("tag")]),e._v(" key in your route. If you provide a "),a("code",[e._v("tag")]),e._v(" which is a string like "),a("code",[e._v('"tag": "Product"')]),e._v(" the algorithm will know that the end-point retrieves data from the "),a("strong",[a("code",[e._v("Product")])]),e._v(" table. Creating a tag object "),a("code",[e._v('{ "tag": { "name": "User", "plugin": "User-Permissions } }')]),e._v(" will result in generating a response with the "),a("strong",[a("code",[e._v("User")])]),e._v(" model from the plugin users-permissions.")])],1)}),[],!1,null,null,null);t.default=o.exports},392:function(e,t,n){e.exports=n.p+"assets/img/open-doc.5dd8ad72.gif"}}]);